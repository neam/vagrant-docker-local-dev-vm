#!/bin/bash

set -x

# enable extended globbing
shopt -s extglob

# run local code if available
if [ -d "/code/proxy" ]; then

    # add environment variable overrides
    echo 'export HOME=/app' >> /app/.profile.d/app-env.sh
    echo 'export REMOTE=1' >> /app/.profile.d/app-env.sh
    echo 'export CMSAPI_HOST=172.17.42.1:50505' >> /app/.profile.d/app-env.sh
    echo 'export CMSEXT_HOST=172.17.42.1:11111' >> /app/.profile.d/app-env.sh
    echo 'export CMSINT_HOST=172.17.42.1:10101' >> /app/.profile.d/app-env.sh
    echo 'export GO_DEPLOYMENT_BASE_URL=127.0.0.1' >> /app/.profile.d/app-env.sh
    echo 'export VIZABI_DEPLOYMENT_BASE_URL=127.0.0.1' >> /app/.profile.d/app-env.sh
    echo 'export PUBLIC_FILES_S3_HOST=127.0.0.1' >> /app/.profile.d/app-env.sh
    echo 'export LOCAL_SERVICES_IP=172.17.42.1' >> /app/.profile.d/app-env.sh

    # necessary file
    cp /app/mime.types /code/proxy/mime.types

else
    echo "WARNING: /code/proxy was not available for configuration"
fi

